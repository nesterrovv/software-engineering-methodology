# Руководство по тестированию Use Cases 1-23

Это руководство описывает как проверить каждый из реализованных use cases через Postman или другим способом.

## Предварительные требования

1. **Запустите монолитное приложение:**
   ```bash
   docker-compose up -d
   ```
   или запустите локально:
   ```bash
   mvn clean package
   java -jar casino-mis-application/target/casino-mis-application-1.0.0.jar
   ```

2. **Импортируйте в Postman:**
   - `Casino_MIS_API_v2.postman_collection.json` - коллекция запросов
   - `Casino_MIS_Local_v2.postman_environment.json` - переменные окружения

3. **Выберите окружение** в Postman: `Casino MIS Local v2`

## Настройка переменных окружения

В Postman Environment должны быть установлены:
- `host`: `http://localhost:8080`
- `username`: `admin`
- `password`: `admin`
- `incidentId`, `violationId`, `activityId`, `monitoringId`, `fraudRecordId`, `notificationId` и другие - будут заполняться автоматически при создании записей

## Подготовка тестовых данных

Для полноценного тестирования необходимо создать тестовые данные. Выполните запросы в следующем порядке:

### Шаг 0: Создание сотрудников (для UC20, UC22, UC23, UC21)

**POST /api/staff/employees**
```json
{
  "firstName": "Иван",
  "lastName": "Петров",
  "middleName": "Сергеевич",
  "position": "Официант",
  "department": "Обслуживание",
  "status": "ACTIVE",
  "contactInfo": "ivan.petrov@casino.local"
}
```

Создайте несколько сотрудников для тестирования:
- Несколько сотрудников в одном подразделении (для UC22)
- Сотрудники с разными должностями

### Шаг 0.1: Создание финансовых операций (для UC9-13)

**POST /api/finance/operations** (UC9)
```json
{
  "cashDeskId": "22222222-2222-2222-2222-222222222222",
  "amount": 5000.00,
  "type": "DEPOSIT",
  "currency": "USD"
}
```

Создайте несколько операций:
- 5-10 операций DEPOSIT (пополнения, ставки игроков) для разных касс
- 3-5 операций WITHDRAWAL (выигрыши) с разными суммами
- Несколько операций с крупными суммами (> 10000) для UC12
- Много операций за короткий период для проверки частоты (UC12)

### Шаг 1: Создание нарушений (для UC16, UC21, UC22)

**POST /api/incident/violations**
```json
{
  "employeeId": "11111111-1111-1111-1111-111111111111",
  "type": "LATE",
  "description": "Опоздание на работу"
}
```

Повторите этот запрос несколько раз с разными типами нарушений для одного и того же `employeeId`, чтобы получить повторяющиеся нарушения.

### Шаг 2: Создание инцидентов (для UC2, UC14)

**POST /api/incident/incidents**
```json
{
  "type": "THEFT",
  "location": "Игровой зал, стол 5",
  "description": "Кража фишек у игрока",
  "participants": ["Игрок ID: 12345", "Подозреваемый ID: 67890"],
  "attachmentUrls": ["https://minio.local/video/theft_incident.mp4"],
  "reportedBy": "11111111-1111-1111-1111-111111111111"
}
```

Создайте несколько инцидентов разных типов (THEFT, FIGHT, DRUNKENNESS, CHEATING, OTHER).

### Шаг 3: Создание жалоб (для UC15)

**POST /api/incident/complaints**
```json
{
  "category": "STAFF_BEHAVIOR",
  "description": "Грубое поведение сотрудника с посетителем",
  "source": "VISITOR",
  "reporterName": "Иван Иванов",
  "relatedIncidentId": "<ID созданного инцидента>"
}
```

Создайте несколько жалоб с разными категориями (SERVICE_QUALITY, STAFF_BEHAVIOR, GAME_ISSUES, SAFETY, OTHER).

---

## Тестирование Use Cases

### UC1: Мониторинг зала

**Описание:** Визуализация текущей ситуации в игровом зале - количество посетителей, персонала, активные столы, аномалии.

**Тестирование:**

1. **Начать мониторинг:**
   - Запрос: **POST /api/security/monitoring/start?securityOfficerId=11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 201, созданная сессия мониторинга с `id`, `status: "ACTIVE"`, `startedAt`
   - Скопируйте `id` в переменную `{{monitoringId}}`

2. **Получить текущее состояние зала:**
   - Запрос: **GET /api/security/monitoring/status**
   - **Ожидаемый результат:** HTTP 200, объект HallStatusResponse с:
     - `totalVisitors` - общее количество посетителей (50-100)
     - `totalStaff` - количество персонала (10-20)
     - `activeTables` - активные столы (15-25)
     - `anomaliesCount` - количество аномалий
     - `zones` - список зон с активностью
     - `recentActivities` - последние активности

3. **Получить сессию мониторинга:**
   - Запрос: **GET /api/security/monitoring/{{monitoringId}}**
   - **Ожидаемый результат:** HTTP 200, информация о сессии мониторинга

4. **Завершить мониторинг:**
   - Запрос: **POST /api/security/monitoring/{{monitoringId}}/end**
   - **Ожидаемый результат:** HTTP 200, сессия со статусом `ENDED`, `endedAt` заполнен

**Проверка:**
- Сессия мониторинга создаётся корректно
- Статус зала отображает актуальные данные (моки)
- При наличии подозрительных контактов они отображаются в `anomaliesCount`
- Зоны активности отображаются корректно

---

### UC2: Регистрация инцидентов

**Описание:** Регистрация инцидентов, произошедших в зале, с указанием типа, описания, участников и материалов.

**Тестирование:**

1. **Создать инцидент:**
   - Запрос: **POST /api/incident/incidents**
   - Body:
     ```json
     {
       "type": "THEFT",
       "location": "Игровой зал, стол 5",
       "description": "Кража фишек у игрока",
       "participants": ["Игрок ID: 12345", "Подозреваемый ID: 67890"],
       "attachmentUrls": ["https://minio.local/video/theft_incident.mp4"],
       "reportedBy": "11111111-1111-1111-1111-111111111111"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданный инцидент с `id`, `status: "OPEN"`, `occurredAt`
   - Скопируйте `id` в переменную `{{incidentId}}`

2. **Получить все инциденты:**
   - Запрос: **GET /api/incident/incidents**
   - **Ожидаемый результат:** HTTP 200, массив всех инцидентов

3. **Получить инциденты с фильтрами:**
   - Запрос: **GET /api/incident/incidents?start=2025-01-01T00:00:00Z&end=2025-12-31T23:59:59Z&type=THEFT**
   - **Ожидаемый результат:** HTTP 200, отфильтрованный список инцидентов

4. **Получить конкретный инцидент:**
   - Запрос: **GET /api/incident/incidents/{{incidentId}}**
   - **Ожидаемый результат:** HTTP 200, детальная информация об инциденте

**Проверка:**
- Инцидент создаётся с правильным типом и статусом
- Фильтрация по датам и типу работает корректно
- Все поля заполняются правильно
- Инцидент автоматически включается в аналитические отчёты (UC14)

---

### UC3: Фиксация подозрительной активности

**Описание:** Фиксация подозрительной активности с указанием участников, времени, типа и уровня риска.

**Тестирование:**

1. **Создать подозрительную активность:**
   - Запрос: **POST /api/incident/suspicious-activities**
   - Body:
     ```json
     {
       "shortDescription": "Подозрительное поведение у стола 7",
       "location": "Игровой зал, стол 7",
       "participants": ["PERSON_001", "PERSON_002"],
       "risk": "HIGH"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная активность с `id`, `risk`, `status: "OPEN"`, `occurredAt`
   - Скопируйте `id` в переменную `{{activityId}}`

2. **Получить все подозрительные активности:**
   - Запрос: **GET /api/incident/suspicious-activities**
   - **Ожидаемый результат:** HTTP 200, массив всех активностей

3. **Получить конкретную активность:**
   - Запрос: **GET /api/incident/suspicious-activities/{{activityId}}**
   - **Ожидаемый результат:** HTTP 200, детальная информация об активности

**Проверка:**
- Активность создаётся с правильным уровнем риска
- Участники сохраняются корректно
- При создании активности автоматически запускается UC6 (сверка с базой мошенников)
- При обнаружении совпадения отправляется уведомление через UC7

---

### UC4: Контроль длительности контактов

**Описание:** Отслеживание длительности контактов между лицами. При превышении лимита создаётся подозрительная активность.

**Тестирование:**

1. **Зарегистрировать контакт:**
   - Запрос: **POST /api/security/contacts**
   - Body:
     ```json
     {
       "personId1": "PERSON_001",
       "personId2": "PERSON_002",
       "contactStartTime": "2025-01-15T10:00:00Z",
       "contactEndTime": "2025-01-15T10:15:00Z",
       "location": "Игровой зал, стол 5"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданный контакт с:
     - `durationSeconds` - рассчитанная длительность (900 секунд = 15 минут)
     - `suspicious` - флаг подозрительности (true, если > 10 минут)
     - `suspiciousActivityId` - ID созданной активности (если контакт подозрительный)

2. **Создать подозрительный контакт (длительность > 10 минут):**
   - Body:
     ```json
     {
       "personId1": "PERSON_003",
       "personId2": "PERSON_004",
       "contactStartTime": "2025-01-15T10:00:00Z",
       "contactEndTime": "2025-01-15T10:20:00Z",
       "location": "Игровой зал, стол 7"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, контакт с `suspicious: true` и `suspiciousActivityId`

3. **Получить подозрительные контакты:**
   - Запрос: **GET /api/security/contacts/suspicious**
   - **Ожидаемый результат:** HTTP 200, список всех подозрительных контактов

4. **Сгенерировать моковые контакты (для тестирования):**
   - Запрос: **POST /api/security/contacts/generate-mocks?count=10**
   - **Ожидаемый результат:** HTTP 200, массив из 10 созданных контактов

**Проверка:**
- Длительность контакта рассчитывается корректно
- При превышении лимита (10 минут) создаётся подозрительная активность (UC3)
- Подозрительные контакты помечаются флагом `suspicious`
- При создании подозрительной активности автоматически запускается UC6 (сверка с базой)

---

### UC5: Контроль частоты взаимодействий

**Описание:** Проверка частоты контактов между двумя лицами. При превышении лимита создаётся подозрительная активность.

**Тестирование:**

1. **Подготовка:**
   - Создайте несколько контактов между одними и теми же лицами через UC4
   - Или используйте генерацию моков: **POST /api/security/contacts/generate-mocks?count=20**

2. **Проверить частоту взаимодействий:**
   - Запрос: **POST /api/security/contacts/check-frequency?personId1=PERSON_001&personId2=PERSON_002**
   - **Ожидаемый результат:** HTTP 200
   - **Проверка:** Если за последний час было более 5 контактов, создаётся подозрительная активность (UC3)

3. **Проверить результат:**
   - Запрос: **GET /api/security/contacts/suspicious**
   - **Ожидаемый результат:** HTTP 200, список должен содержать контакты с высокой частотой

**Проверка:**
- Частота контактов рассчитывается корректно
- При превышении лимита (5 контактов за час) создаётся подозрительная активность
- Подозрительные контакты помечаются автоматически
- Интеграция с UC3 работает корректно

---

### UC6: Сверка с базой мошенников

**Описание:** Автоматическая сверка лиц с базой мошенников. При совпадении отправляется уведомление.

**Тестирование:**

1. **Добавить запись в базу мошенников:**
   - Запрос: **POST /api/security/fraud-database**
   - Body:
     ```json
     {
       "personId": "FRAUD_001",
       "fullName": "Иван Иванов",
       "description": "Известный мошенник в карточных играх",
       "fraudType": "CHEATING",
       "addedBy": "11111111-1111-1111-1111-111111111111"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная запись с `id`, `status: "ACTIVE"`, `addedAt`
   - Скопируйте `id` в переменную `{{fraudRecordId}}`

2. **Проверить лицо в базе:**
   - Запрос: **POST /api/security/fraud-check**
   - Body:
     ```json
     {
       "personId": "FRAUD_001",
       "activityId": null
     }
     ```
   - **Ожидаемый результат:** HTTP 200, объект FraudCheckResponse с:
     - `matchFound: true`
     - `fraudRecord` - информация о найденной записи
     - `notificationSent: true` - уведомление отправлено (UC7)

3. **Быстрая проверка:**
   - Запрос: **POST /api/security/fraud-check/quick?personId=FRAUD_001**
   - **Ожидаемый результат:** HTTP 200, результат проверки

4. **Получить все записи в базе:**
   - Запрос: **GET /api/security/fraud-database**
   - **Ожидаемый результат:** HTTP 200, массив всех записей

5. **Поиск в базе:**
   - Запрос: **GET /api/security/fraud-database/search?q=Иван**
   - **Ожидаемый результат:** HTTP 200, найденные записи

6. **Получить записи по типу:**
   - Запрос: **GET /api/security/fraud-database/type/CHEATING**
   - **Ожидаемый результат:** HTTP 200, записи типа CHEATING

7. **Изменить статус записи:**
   - Запрос: **PATCH /api/security/fraud-database/{{fraudRecordId}}/status?status=ARCHIVED**
   - **Ожидаемый результат:** HTTP 200, запись со статусом ARCHIVED

**Проверка:**
- Записи в базе мошенников создаются и сохраняются корректно
- Проверка находит совпадения по personId
- При совпадении автоматически отправляется уведомление через UC7
- Поиск и фильтрация работают корректно
- Статусы записей обновляются правильно

---

### UC7: Система автоматических уведомлений

**Описание:** Система автоматических уведомлений для различных событий (подозрительная активность, обнаружение мошенника, отсутствие отметки выхода и т.д.).

**Тестирование:**

1. **Создать уведомление вручную:**
   - Запрос: **POST /api/security/notifications**
   - Body:
     ```json
     {
       "recipientId": "11111111-1111-1111-1111-111111111111",
       "type": "SYSTEM_ALERT",
       "title": "Тестовое уведомление",
       "message": "Сообщение для тестирования системы уведомлений",
       "priority": "HIGH",
       "relatedEntityType": "SUSPICIOUS_ACTIVITY",
       "relatedEntityId": null
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданное уведомление с `id`, `status: "SENT"`, `createdAt`
   - Скопируйте `id` в переменную `{{notificationId}}`

2. **Получить все уведомления получателя:**
   - Запрос: **GET /api/security/notifications/recipient/11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 200, массив всех уведомлений для получателя

3. **Получить непрочитанные уведомления:**
   - Запрос: **GET /api/security/notifications/recipient/11111111-1111-1111-1111-111111111111/unread**
   - **Ожидаемый результат:** HTTP 200, массив непрочитанных уведомлений

4. **Получить количество непрочитанных:**
   - Запрос: **GET /api/security/notifications/recipient/11111111-1111-1111-1111-111111111111/unread-count**
   - **Ожидаемый результат:** HTTP 200, число непрочитанных уведомлений

5. **Отметить уведомление как прочитанное:**
   - Запрос: **POST /api/security/notifications/{{notificationId}}/read**
   - **Ожидаемый результат:** HTTP 200, уведомление с `status: "READ"`, `readAt` заполнен

6. **Проверить автоматические уведомления:**
   - Создайте подозрительную активность (UC3) - должно отправиться уведомление
   - Проверьте лицо в базе мошенников (UC6) - при совпадении должно отправиться уведомление
   - Проверьте отсутствующие отметки выхода (UC20) - должно отправиться уведомление HR

**Проверка:**
- Уведомления создаются и сохраняются в БД
- Уведомления автоматически отправляются при различных событиях
- Статус уведомлений обновляется корректно (SENT → READ)
- Фильтрация по получателю и статусу работает
- Интеграция с другими модулями (UC3, UC6, UC20) работает через Feign Client

---

### UC21: Фиксация нарушений дисциплины

**Описание:** Регистрация дисциплинарных нарушений сотрудников (опоздания, нарушения правил и т.д.).

**Тестирование:**

1. **Создать нарушение:**
   - Запрос: **POST /api/incident/violations**
   - Body:
     ```json
     {
       "employeeId": "11111111-1111-1111-1111-111111111111",
       "type": "LATE",
       "description": "Опоздание более чем на 10 минут",
       "attachmentUrls": ["https://minio.local/video/incident123.mp4"]
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданное нарушение с `id`, `type`, `status: "OPEN"`, `occurredAt`
   - Скопируйте `id` в переменную `{{violationId}}`

2. **Получить все нарушения:**
   - Запрос: **GET /api/incident/violations**
   - **Ожидаемый результат:** HTTP 200, массив всех нарушений

3. **Получить конкретное нарушение:**
   - Запрос: **GET /api/incident/violations/{{violationId}}**
   - **Ожидаемый результат:** HTTP 200, детальная информация о нарушении

4. **Получить нарушения сотрудника:**
   - Запрос: **GET /api/incident/violations/employee/11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 200, массив всех нарушений конкретного сотрудника

**Проверка:**
- Нарушение создаётся с правильным типом и статусом
- Все поля заполняются корректно
- Нарушения фильтруются по сотруднику
- Нарушения используются в UC16 (повторяющиеся нарушения)
- Нарушения учитываются в UC22 (история нарушений) и UC23 (управление сменами)

---

### UC20: Учёт времени работы сотрудников

**Описание:** Фиксация начала и конца смен сотрудников; расчёт фактических часов.

**Тестирование:**

1. **Отметка входа:**
   - Запрос: **POST /api/staff/work-time/clock-in**
   - Body:
     ```json
     {
       "employeeId": "11111111-1111-1111-1111-111111111111",
       "deviceId": "TERMINAL_001"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная запись с `clockInTime`, `status: "OPEN"`

2. **Отметка выхода:**
   - Запрос: **POST /api/staff/work-time/clock-out**
   - Body:
     ```json
     {
       "employeeId": "11111111-1111-1111-1111-111111111111",
       "deviceId": "TERMINAL_001"
     }
     ```
   - **Ожидаемый результат:** HTTP 200, обновлённая запись с:
     - `clockOutTime` - время выхода
     - `workedMinutes` - отработанные минуты
     - `isLate` - флаг опоздания (если вход после 9:00)
     - `hasOvertime` - флаг переработки (если > 8 часов)
     - `status: "CLOSED"`

3. **Получить записи сотрудника:**
   - Запрос: **GET /api/staff/work-time/employee/11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 200, массив всех записей учёта времени

4. **Проверка отсутствующих отметок выхода:**
   - Создайте запись входа (clock-in)
   - Подождите (или измените время в БД вручную)
   - Запрос: **POST /api/staff/work-time/check-missing-clock-outs**
   - **Ожидаемый результат:** HTTP 200, записи без выхода помечены как `MISSING_CLOCK_OUT`, отправлено уведомление HR (UC7)

**Проверка:**
- Нельзя создать вторую открытую смену для сотрудника
- Отработанное время рассчитывается корректно
- Опоздания и переработки определяются правильно
- При отсутствии отметки выхода отправляется уведомление через UC7

---

### UC22: Просмотр истории нарушений

**Описание:** Поиск и фильтрация истории дисциплинарных нарушений по сотруднику, подразделению, датам, типу.

**Тестирование:**

1. **Подготовка:**
   - Убедитесь, что есть нарушения в системе (через UC21 в incident модуле)
   - Создайте несколько нарушений для одного сотрудника

2. **Получить историю нарушений сотрудника:**
   - Запрос: **GET /api/staff/violation-history/employee/11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 200, объект ViolationHistoryResponse с:
     - `violations` - список нарушений
     - `summary` - сводка (общее количество, по типам, по подразделениям)

3. **Поиск с фильтрами:**
   - Запрос: **POST /api/staff/violation-history/search**
   - Body:
     ```json
     {
       "employeeId": "11111111-1111-1111-1111-111111111111",
       "startDate": "2025-01-01T00:00:00Z",
       "endDate": "2025-12-31T23:59:59Z",
       "violationType": "LATE"
     }
     ```
   - **Ожидаемый результат:** HTTP 200, отфильтрованный список нарушений

4. **Получить нарушения по подразделению:**
   - Запрос: **GET /api/staff/violation-history/department/Обслуживание**
   - **Ожидаемый результат:** HTTP 200, сводный отчёт по подразделению

**Проверка:**
- Фильтрация по датам работает корректно
- Фильтрация по типу работает
- Группировка по подразделениям работает
- Интеграция с UC21 (incident модуль) через Feign Client работает

---

### UC23: Управление сменами и загрузкой

**Описание:** Планирование графиков смен с учётом загрузки, отпусков, дисциплинарных замечаний.

**Тестирование:**

1. **Получить доступность сотрудников:**
   - Запрос: **GET /api/staff/shifts/availability?startDate=2025-01-01&endDate=2025-01-31**
   - **Ожидаемый результат:** HTTP 200, объект с:
     - Список сотрудников с количеством запланированных смен
     - Информация о нарушениях (UC21)
     - Рекомендации по распределению

2. **Создать расписание смены:**
   - Запрос: **POST /api/staff/shifts**
   - Body:
     ```json
     {
       "employeeId": "11111111-1111-1111-1111-111111111111",
       "shiftDate": "2025-01-20",
       "plannedStartTime": "2025-01-20T08:00:00Z",
       "plannedEndTime": "2025-01-20T16:00:00Z",
       "shiftType": "DAY",
       "location": "Игровой зал",
       "createdBy": "22222222-2222-2222-2222-222222222222"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная смена со статусом `DRAFT`
   - **Проверка:** Система учитывает нарушения сотрудника (UC21) через Feign Client

3. **Опубликовать график:**
   - Скопируйте `id` смены в `{{shiftId}}`
   - Запрос: **POST /api/staff/shifts/{{shiftId}}/publish**
   - **Ожидаемый результат:** HTTP 200, смена со статусом `PUBLISHED`
   - **Проверка:** После публикации данные доступны для UC20 (учёт времени)

4. **Подтвердить смену:**
   - Запрос: **POST /api/staff/shifts/{{shiftId}}/confirm?confirmedBy=11111111-1111-1111-1111-111111111111**
   - **Ожидаемый результат:** HTTP 200, смена со статусом `CONFIRMED`

5. **Перераспределить смену:**
   - Запрос: **POST /api/staff/shifts/{{shiftId}}/reassign?newEmployeeId=33333333-3333-3333-3333-333333333333`
   - **Ожидаемый результат:** HTTP 200, смена переназначена другому сотруднику

**Проверка:**
- При создании смены учитываются нарушения (UC21) через Feign
- Доступность сотрудников рассчитывается корректно
- После публикации смены они доступны для UC20
- Перераспределение проверяет доступность нового сотрудника
- Экстренное перераспределение работает при отсутствии сотрудника

---

### UC9: Регистрация операций (Finance Module)

**Описание:** Система регистрирует денежные операции (пополнения и снятия) по кассам.

**Тестирование:**

1. **Создать операцию:**
   - Запрос: **POST /api/finance/operations**
   - Body:
     ```json
     {
       "cashDeskId": "22222222-2222-2222-2222-222222222222",
       "amount": 2000.50,
       "type": "DEPOSIT",
       "currency": "USD"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная операция с `id`, `operatedAt`

2. **Получить все операции:**
   - Запрос: **GET /api/finance/operations**
   - **Ожидаемый результат:** HTTP 200, массив всех операций

3. **Получить конкретную операцию:**
   - Скопируйте `id` операции в переменную `{{operationId}}`
   - Запрос: **GET /api/finance/operations/{{operationId}}`
   - **Ожидаемый результат:** HTTP 200, информация об операции

**Проверка:**
- Операции можно создавать с типами DEPOSIT и WITHDRAWAL
- Валидация работает корректно (обязательные поля)
- Операции сохраняются с временной меткой

---

### UC10: Формирование финансовых отчётов

**Описание:** Система формирует CSV отчёты по финансовым операциям за указанный период.

**Тестирование:**

1. **Создать финансовый отчёт:**
   - Запрос: **POST /api/finance/reports**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01",
       "periodEnd": "2025-01-31"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, объект с `id`, `csvUrl` (ссылка на S3)

**Проверка:**
- Отчёт содержит все операции за указанный период
- CSV файл доступен по ссылке в S3
- Отчёт сохраняется в базе данных

---

### UC11: Контроль кассы

**Описание:** Сравнение фактических остатков с расчётным балансом; отчёты о расхождениях.

**Тестирование:**

1. **Подготовка:**
   - Создайте несколько операций для одной кассы (cashDeskId) за период смены
   - Например, создайте 3-5 операций DEPOSIT и 2-3 операции WITHDRAWAL

2. **Выполнить сверку кассы:**
   - Запрос: **POST /api/finance/reconciliation**
   - Body:
     ```json
     {
       "cashDeskId": "22222222-2222-2222-2222-222222222222",
       "shiftStart": "2025-01-01T08:00:00Z",
       "shiftEnd": "2025-01-01T20:00:00Z",
       "actualBalance": 50000.00,
       "notes": "Сверка после смены"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, объект Reconciliation с:
     - `expectedBalance` - рассчитанный баланс на основе операций
     - `actualBalance` - фактический баланс
     - `discrepancy` - расхождение
     - `status` - CONFIRMED (если расхождение < 0.01) или DISCREPANCY_FOUND

3. **Получить сверку:**
   - Скопируйте `id` сверки в `{{reconciliationId}}`
   - Запрос: **GET /api/finance/reconciliation/{{reconciliationId}}`
   - **Ожидаемый результат:** HTTP 200, полная информация о сверке

4. **Получить все сверки по кассе:**
   - Запрос: **GET /api/finance/reconciliation/cashdesk/22222222-2222-2222-2222-222222222222`
   - **Ожидаемый результат:** HTTP 200, массив всех сверок для кассы

5. **Изменить статус сверки:**
   - Запрос: **PATCH /api/finance/reconciliation/{{reconciliationId}}/status?status=RESOLVED`
   - **Ожидаемый результат:** HTTP 200, обновлённая сверка

**Проверка:**
- Ожидаемый баланс рассчитывается корректно (сумма DEPOSIT - сумма WITHDRAWAL)
- Расхождение вычисляется правильно
- Статус определяется автоматически на основе расхождения
- При существенном расхождении (интеграция с UC12) можно запустить проверку аномалий

---

### UC12: Выявление аномальных транзакций

**Описание:** Алгоритмы анализируют денежные операции, выделяя подозрительные записи.

**Тестирование:**

1. **Подготовка:**
   - Создайте несколько операций с крупными суммами (> 10000)
   - Создайте несколько операций с высокой частотой (много операций за короткий период)

2. **Запустить обнаружение аномалий:**
   - Запрос: **POST /api/finance/anomalies/detect**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "largeAmountThreshold": 10000,
       "frequencyThreshold": 10,
       "timeWindowMinutes": 60
     }
     ```
   - **Ожидаемый результат:** HTTP 201, массив обнаруженных аномалий с:
     - `type` - тип аномалии (LARGE_AMOUNT, HIGH_FREQUENCY, etc.)
     - `riskLevel` - уровень риска (LOW, MEDIUM, HIGH, CRITICAL)
     - `reason` - причина аномалии
     - `status` - DETECTED

3. **Получить все аномалии:**
   - Запрос: **GET /api/finance/anomalies**
   - **Ожидаемый результат:** HTTP 200, массив всех аномалий

4. **Получить аномалии с фильтрацией:**
   - Запрос: **GET /api/finance/anomalies?status=DETECTED&riskLevel=HIGH`
   - **Ожидаемый результат:** HTTP 200, отфильтрованные аномалии

5. **Просмотреть конкретную аномалию:**
   - Скопируйте `id` аномалии в `{{anomalyId}}`
   - Запрос: **GET /api/finance/anomalies/{{anomalyId}}`
   - **Ожидаемый результат:** HTTP 200, информация об аномалии

6. **Подтвердить/отклонить аномалию:**
   - Запрос: **POST /api/finance/anomalies/{{anomalyId}}/review?status=CONFIRMED&reviewerId=11111111-1111-1111-1111-111111111111&notes=Подтверждено`
   - **Ожидаемый результат:** HTTP 200, обновлённая аномалия со статусом CONFIRMED

**Проверка:**
- Обнаруживаются транзакции с суммами выше порога
- Обнаруживаются транзакции с высокой частотой в окне времени
- Риск оценивается на основе величины отклонения
- Аналитик может подтвердить или отклонить аномалию
- Подтверждённые аномалии могут использоваться в отчётах (UC17, UC18)

---

### UC13: Анализ выигрышей и проигрышей

**Описание:** Оценка RTP (Return to Player), распределения выплат; выявление аномальных выигрышей.

**Тестирование:**

1. **Подготовка:**
   - Создайте операции DEPOSIT (ставки игроков) и WITHDRAWAL (выигрыши)
   - Для одной кассы/стола создайте несколько операций за период

2. **Выполнить анализ игровых сессий:**
   - Запрос: **POST /api/finance/game-analysis**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "gameTableId": "22222222-2222-2222-2222-222222222222",
       "expectedRtp": 95.0,
       "largeWinThreshold": 1000
     }
     ```
   - **Ожидаемый результат:** HTTP 201, объект GameAnalysis с:
     - `totalBets` - суммарные ставки
     - `totalWins` - суммарные выигрыши
     - `rtp` - рассчитанный RTP в процентах
     - `rtpDeviation` - отклонение от ожидаемого RTP
     - `largeWinsCount` - количество крупных выигрышей
     - `largestWinAmount` - самый крупный выигрыш

3. **Получить анализ:**
   - Скопируйте `id` анализа в `{{gameAnalysisId}}`
   - Запрос: **GET /api/finance/game-analysis/{{gameAnalysisId}}`
   - **Ожидаемый результат:** HTTP 200, полная информация об анализе

4. **Получить анализы по столу/автомату:**
   - Запрос: **GET /api/finance/game-analysis/table/22222222-2222-2222-2222-222222222222`
   - **Ожидаемый результат:** HTTP 200, массив анализов для указанного стола

**Проверка:**
- RTP рассчитывается корректно: (totalWins / totalBets) * 100
- Отклонение RTP вычисляется относительно ожидаемого значения
- Крупные выигрыши определяются по порогу
- При обнаружении крупных выигрышей они передаются в UC12 для проверки
- При значительном отклонении RTP (> 5%) это отмечается в notes

**Пример расчёта:**
- Ставки (DEPOSIT): 10000 USD
- Выигрыши (WITHDRAWAL): 9500 USD
- RTP = (9500 / 10000) * 100 = 95%
- Если expectedRtp = 95%, то rtpDeviation = 0%

---

### UC14: Формирование отчётов по инцидентам

**Описание:** Система формирует отчёт, содержащий данные об инцидентах за указанный период.

**Тестирование:**

1. **Создать отчёт по инцидентам:**
   - Запрос: **POST /api/incident/reports/incidents**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "incidentTypes": ["THEFT", "FIGHT"],
       "generatedBy": "11111111-1111-1111-1111-111111111111"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, в ответе будет объект Report с `id`, `type: "INCIDENTS"`, и `reportData` (JSON строка)

2. **Получить список всех отчётов по инцидентам:**
   - Запрос: **GET /api/incident/reports?type=INCIDENTS**
   - **Ожидаемый результат:** HTTP 200, массив отчётов типа INCIDENTS

3. **Получить конкретный отчёт:**
   - Скопируйте `id` из предыдущего ответа в переменную `{{reportId}}` в Postman
   - Запрос: **GET /api/incident/reports/{{reportId}}**
   - **Ожидаемый результат:** HTTP 200, полная информация об отчёте

4. **Получить инциденты с фильтрацией:**
   - Запрос: **GET /api/incident/incidents?start=2025-01-01T00:00:00Z&end=2025-12-31T23:59:59Z&type=THEFT`
   - **Ожидаемый результат:** HTTP 200, массив инцидентов типа THEFT за указанный период

**Проверка:**
- Отчёт содержит `totalIncidents` - общее количество инцидентов
- Отчёт содержит `totalComplaints` - общее количество жалоб за период
- Отчёт содержит `incidentsByType` - группировка по типам
- Отчёт содержит `complaintsByCategory` - группировка жалоб по категориям

---

### UC15: Централизованная база жалоб

**Описание:** Акторы фиксируют, просматривают и анализируют жалобы от посетителей или сотрудников.

**Тестирование:**

1. **Создать жалобу:**
   - Запрос: **POST /api/incident/complaints**
   - Body:
     ```json
     {
       "category": "STAFF_BEHAVIOR",
       "description": "Грубое поведение сотрудника",
       "source": "VISITOR",
       "reporterName": "Иван Иванов",
       "relatedIncidentId": "{{incidentId}}"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, созданная жалоба с `id`

2. **Получить все жалобы:**
   - Запрос: **GET /api/incident/complaints**
   - **Ожидаемый результат:** HTTP 200, массив всех жалоб

3. **Получить жалобы с фильтрацией:**
   - Запрос: **GET /api/incident/complaints?start=2025-01-01T00:00:00Z&end=2025-12-31T23:59:59Z&category=STAFF_BEHAVIOR&source=VISITOR`
   - **Ожидаемый результат:** HTTP 200, отфильтрованные жалобы

4. **Получить конкретную жалобу:**
   - Скопируйте `id` жалобы в переменную `{{complaintId}}`
   - Запрос: **GET /api/incident/complaints/{{complaintId}}`
   - **Ожидаемый результат:** HTTP 200, информация о жалобе

5. **Изменить статус жалобы:**
   - Запрос: **PATCH /api/incident/complaints/{{complaintId}}/status?status=RESOLVED`
   - **Ожидаемый результат:** HTTP 200, обновлённая жалоба со статусом RESOLVED

**Проверка:**
- Жалобы можно создавать с разными категориями и источниками
- Фильтрация работает корректно по дате, категории и источнику
- Статус жалобы можно обновлять (OPEN, IN_PROGRESS, RESOLVED, CLOSED)

---

### UC16: Повторяющиеся нарушения сотрудников

**Описание:** Аналитика частоты дисциплинарных нарушений, выделение «рисковых» сотрудников.

**Тестирование:**

1. **Получить список сотрудников с повторяющимися нарушениями:**
   - Запрос: **POST /api/incident/reports/repeated-violations**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "threshold": 3
     }
     ```
   - **Ожидаемый результат:** HTTP 200, объект с массивом `employees`, каждый содержит:
     - `employeeId` - ID сотрудника
     - `violationCount` - количество нарушений

**Проверка:**
- В ответе только сотрудники с количеством нарушений >= threshold
- Для сотрудника с ID `11111111-1111-1111-1111-111111111111` (если создавали несколько нарушений) должен быть count >= 3

**Альтернативный тест через SQL:**
```sql
SELECT employee_id, COUNT(*) as violation_count
FROM disciplinary_violation
WHERE occurred_at BETWEEN '2025-01-01' AND '2025-12-31'
GROUP BY employee_id
HAVING COUNT(*) >= 3;
```

---

### UC17: Генерация отчётов для руководства

**Описание:** Формирование сводных отчётов для руководства о текущем состоянии дел.

**Тестирование:**

1. **Создать отчёт для руководства:**
   - Запрос: **POST /api/incident/reports/management**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "generatedBy": "11111111-1111-1111-1111-111111111111"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, объект Report с `type: "MANAGEMENT"`

2. **Получить отчёт:**
   - Скопируйте `id` отчёта в `{{reportId}}`
   - Запрос: **GET /api/incident/reports/{{reportId}}`
   - Парсите `reportData` (JSON строка)

**Проверка содержимого `reportData`:**
```json
{
  "summary": {
    "totalIncidents": <число>,
    "totalComplaints": <число>,
    "totalViolations": <число>,
    "employeesWithRepeatedViolations": <число>
  },
  "incidentsSummary": {
    "byType": {...},
    "byStatus": {...}
  },
  "complaintsSummary": {
    "byCategory": {...},
    "byStatus": {...}
  },
  "violationsSummary": {
    "byType": {...},
    "byStatus": {...}
  },
  "repeatedViolations": [...]
}
```

**Проверка:**
- Отчёт содержит агрегированную информацию по всем инцидентам, жалобам и нарушениям
- Включена информация о повторяющихся нарушениях (UC16)
- Данные сгруппированы по типам, статусам и категориям

---

### UC18: Генерация отчётов для регуляторов

**Описание:** Подготовка и предоставление отчётов, соответствующих нормативным требованиям контролирующих органов.

**Тестирование:**

1. **Создать отчёт для регуляторов:**
   - Запрос: **POST /api/incident/reports/regulatory**
   - Body:
     ```json
     {
       "periodStart": "2025-01-01T00:00:00Z",
       "periodEnd": "2025-12-31T23:59:59Z",
       "generatedBy": "11111111-1111-1111-1111-111111111111"
     }
     ```
   - **Ожидаемый результат:** HTTP 201, объект Report с `type: "REGULATORY"`

2. **Получить отчёт:**
   - Запрос: **GET /api/incident/reports/{{reportId}}`
   - Парсите `reportData`

**Проверка содержимого `reportData`:**
```json
{
  "incidents": [
    {
      "id": "...",
      "type": "...",
      "location": "...",
      "occurredAt": "...",
      "status": "...",
      "description": "..."
    }
  ],
  "complaints": [...],
  "violations": [...]
}
```

**Проверка:**
- Отчёт содержит детальную информацию о каждом инциденте, жалобе и нарушении
- Все поля заполнены для полноты информации для регулятора
- Данные структурированы для официальной отчётности

---

### UC19: Экспорт в PDF / Excel

**Описание:** Экспорт отчётов и аналитических данных в форматы PDF или Excel.

**Тестирование:**

1. **Подготовка:**
   - Создайте любой отчёт (UC14, UC17 или UC18)
   - Скопируйте `id` отчёта в `{{reportId}}`

2. **Экспорт в PDF:**
   - Запрос: **GET /api/incident/reports/{{reportId}}/export/pdf`
   - **Ожидаемый результат:** 
     - HTTP 200
     - Content-Type: `application/pdf`
     - Content-Disposition: `attachment; filename=report_<id>.pdf`
     - В Postman нажмите "Send and Download" чтобы скачать файл
   
   **Проверка:**
   - Файл скачивается как PDF
   - Откройте файл и убедитесь, что он содержит информацию об отчёте

3. **Экспорт в Excel:**
   - Запрос: **GET /api/incident/reports/{{reportId}}/export/excel`
   - **Ожидаемый результат:**
     - HTTP 200
     - Content-Type: `application/octet-stream`
     - Content-Disposition: `attachment; filename=report_<id>.xlsx`
     - В Postman нажмите "Send and Download"
   
   **Проверка:**
   - Файл скачивается как Excel (.xlsx)
   - Откройте файл в Excel/LibreOffice и проверьте структуру данных
   - Должны быть колонки: Report ID, Type, Period Start, Period End, Generated At
   - Дополнительные строки с данными из `reportData`

**Альтернативный способ (curl):**

```bash
# PDF экспорт
curl -u admin:admin \
  -o report.pdf \
  "http://localhost:8080/api/incident/reports/{{reportId}}/export/pdf"

# Excel экспорт
curl -u admin:admin \
  -o report.xlsx \
  "http://localhost:8080/api/incident/reports/{{reportId}}/export/excel"
```

---

## Быстрая проверка работоспособности

### Через Swagger UI (рекомендуется для начала)

1. Запустите приложение
2. Откройте http://localhost:8080/swagger-ui.html
3. Авторизуйтесь (admin/admin)
4. Проверьте каждый модуль:
   - Security Module: UC1, UC4-7
   - Incident Module: UC2, UC3, UC14-19, UC21
   - Finance Module: UC9-13
   - Staff Module: UC20, UC22-23

### Через Postman

См. подробные инструкции ниже для каждого use case.

---

## Полный сценарий тестирования

Для полной проверки всех use cases выполните запросы в следующем порядке:

1. **Подготовка данных:**
   - **Security:**
     - Добавьте несколько записей в базу мошенников через UC6
     - Создайте несколько контактов через генерацию моков (UC4, UC5)
   - **Staff:**
     - Создайте несколько сотрудников (для UC20, UC21, UC22, UC23)
   - **Finance:**
     - Создайте 10-15 операций DEPOSIT для разных касс (UC9)
     - Создайте 5-8 операций WITHDRAWAL (выигрыши) (UC9)
     - Создайте несколько операций с крупными суммами (> 10000) для UC12
     - Создайте много операций за короткий период для проверки частоты (UC12)
   - **Incident:**
     - Создайте 5-10 нарушений для одного сотрудника (UC16, UC21)
     - Создайте 3-5 инцидентов разных типов (UC2, UC14)
     - Создайте 3-5 жалоб разных категорий (UC15)
     - Создайте несколько подозрительных активностей (UC3)

2. **UC1:** Начните мониторинг зала, получите статус, завершите мониторинг

3. **UC2:** Создайте инцидент, получите список с фильтрами

4. **UC3:** Создайте подозрительную активность, проверьте автоматическую сверку с базой (UC6)

5. **UC4:** Зарегистрируйте контакт, проверьте расчёт длительности и создание подозрительной активности

6. **UC5:** Создайте несколько контактов между одними лицами, проверьте частоту

7. **UC6:** Добавьте запись в базу мошенников, проверьте поиск и сверку

8. **UC7:** Создайте уведомление, получите список, отметьте как прочитанное

9. **UC9:** Проверьте создание и получение операций

10. **UC10:** Создайте финансовый отчёт, проверьте CSV в S3

11. **UC11:** Выполните сверку кассы, проверьте расчёт ожидаемого баланса и расхождений

12. **UC12:** Запустите обнаружение аномалий, проверьте различные типы аномалий, подтвердите/отклоните

13. **UC13:** Выполните анализ игровых сессий, проверьте расчёт RTP, проверьте передачу крупных выигрышей в UC12

14. **UC14:** Создайте отчёт по инцидентам, получите его, проверьте содержимое

15. **UC15:** Создайте жалобу, получите список, измените статус

16. **UC16:** Получите список сотрудников с повторяющимися нарушениями

17. **UC17:** Создайте отчёт для руководства, проверьте агрегированные данные

18. **UC18:** Создайте отчёт для регуляторов, проверьте детальные данные

19. **UC19:** Экспортируйте любой отчёт в PDF и Excel

20. **UC20:** Отметьте вход и выход сотрудника, проверьте расчёт времени

21. **UC21:** Создайте нарушение дисциплины, получите список нарушений сотрудника

22. **UC22:** Просмотрите историю нарушений сотрудника и по подразделению

23. **UC23:** Создайте и опубликуйте график смен, проверьте доступность сотрудников

---

## Проверка через базу данных

Для дополнительной проверки можете выполнить SQL запросы:

```sql
-- Finance Module
-- Проверка операций
SELECT * FROM cash_operations ORDER BY operated_at DESC;

-- Проверка финансовых отчётов
SELECT * FROM financial_reports ORDER BY period_start DESC;

-- Проверка сверок касс (UC11)
SELECT * FROM cash_register_reconciliations ORDER BY created_at DESC;

-- Проверка аномальных транзакций (UC12)
SELECT * FROM anomalous_transactions ORDER BY detected_at DESC;

-- Проверка анализов игр (UC13)
SELECT * FROM game_session_analyses ORDER BY analyzed_at DESC;

-- Incident Module
-- Проверка инцидентов
SELECT * FROM incidents ORDER BY occurred_at DESC;

-- Проверка жалоб
SELECT * FROM complaints ORDER BY reported_at DESC;

-- Проверка отчётов
SELECT id, type, generated_at, status FROM reports ORDER BY generated_at DESC;

-- Проверка нарушений по сотруднику
SELECT employee_id, COUNT(*) as count 
FROM disciplinary_violation 
GROUP BY employee_id 
HAVING COUNT(*) >= 3;

-- Security Module
-- Проверка сессий мониторинга зала (UC1)
SELECT * FROM hall_monitoring ORDER BY started_at DESC;

-- Проверка контактов (UC4, UC5)
SELECT * FROM contact_events ORDER BY contact_start_time DESC;
SELECT * FROM contact_events WHERE suspicious = true;

-- Проверка базы мошенников (UC6)
SELECT * FROM fraud_database WHERE status = 'ACTIVE';

-- Проверка уведомлений (UC7)
SELECT * FROM notifications ORDER BY created_at DESC;
SELECT * FROM notifications WHERE status = 'UNREAD';

-- Проверка подозрительных активностей (UC3)
SELECT * FROM suspicious_activity ORDER BY occurred_at DESC;

-- Incident Module
-- Проверка нарушений (UC21)
SELECT * FROM disciplinary_violation ORDER BY occurred_at DESC;
SELECT employee_id, COUNT(*) as count FROM disciplinary_violation GROUP BY employee_id;

-- Staff Module
-- Проверка записей учёта времени (UC20)
SELECT * FROM work_time_records ORDER BY clock_in_time DESC;

-- Проверка открытых смен без отметки выхода
SELECT * FROM work_time_records WHERE status = 'OPEN' OR status = 'MISSING_CLOCK_OUT';

-- Проверка расписания смен (UC23)
SELECT * FROM shift_schedules ORDER BY shift_date DESC, planned_start_time;

-- Проверка сотрудников
SELECT * FROM employees ORDER BY created_at DESC;
```

---

## Устранение неполадок

1. **Ошибка 401 Unauthorized:**
   - Проверьте credentials в Postman Environment (admin/admin)
   - Убедитесь что используете правильное окружение
   - В Swagger UI нажмите "Authorize" и введите admin/admin

2. **Ошибка 500 Internal Server Error:**
   - Проверьте логи приложения: `docker compose logs -f casino-mis-application`
   - Убедитесь что Liquibase миграции выполнились успешно
   - Проверьте подключение к базе данных
   - Проверьте что MinIO доступен (для UC10, UC19)

3. **Пустые отчёты:**
   - Убедитесь что созданы тестовые данные (операции, инциденты, жалобы, нарушения)
   - Проверьте период в запросе - он должен покрывать даты создания данных
   - Для UC11-13 убедитесь что есть операции за указанный период

4. **Проблемы с экспортом (UC19):**
   - Убедитесь что зависимости iText и Apache POI установлены
   - Проверьте что отчёт существует перед экспортом
   - Проверьте логи приложения на наличие ошибок генерации PDF/Excel

5. **Проблемы с UC11 (Сверка кассы):**
   - Убедитесь что созданы операции для указанной кассы (cashDeskId)
   - Проверьте что shiftStart и shiftEnd покрывают период с операциями

6. **Проблемы с UC12 (Обнаружение аномалий):**
   - Создайте операции с крупными суммами (> порога) для тестирования
   - Или создайте много операций за короткий период для проверки частоты

7. **Проблемы с UC13 (Анализ игр):**
   - Убедитесь что есть и DEPOSIT и WITHDRAWAL операции
   - Для корректного RTP нужно, чтобы totalBets > 0

8. **Проблемы с UC1 (Мониторинг зала):**
   - Данные о зале генерируются как моки (случайные значения)
   - Для реальных данных нужна интеграция с системами видеонаблюдения

9. **Проблемы с UC3 (Подозрительная активность):**
   - При создании активности автоматически запускается UC6 (сверка с базой)
   - Убедитесь что база мошенников содержит тестовые данные

10. **Проблемы с UC4, UC5 (Контроль контактов):**
    - Лимит длительности: 10 минут (600 секунд)
    - Лимит частоты: 5 контактов за последний час
    - При превышении лимитов создаётся подозрительная активность (UC3)

11. **Проблемы с UC6 (Сверка с базой):**
    - При совпадении автоматически отправляется уведомление (UC7)
    - Проверьте что уведомления создаются в БД

12. **Проблемы с UC7 (Уведомления):**
    - Уведомления автоматически создаются при различных событиях
    - Проверьте интеграцию с другими модулями через Feign Client

13. **Проблемы с UC20 (Учёт времени):**
    - Убедитесь что сотрудник существует в системе перед отметкой входа
    - Нельзя создать вторую открытую смену для сотрудника

14. **Проблемы с UC21 (Нарушения):**
    - Нарушения используются в UC16, UC22, UC23
    - Убедитесь что employeeId существует в системе

15. **Проблемы с UC22 (История нарушений):**
    - Убедитесь что есть нарушения в incident модуле (UC21)
    - Сотрудники должны существовать в staff модуле для корректного отображения имён

16. **Проблемы с UC23 (Управление сменами):**
    - При создании смены проверяется доступность сотрудника
    - Убедитесь что сотрудник активен (status = ACTIVE)
    - Учитываются нарушения через интеграцию с incident модулем

---

## Проверка через OpenAPI (Swagger UI)

После запуска приложения откройте в браузере:

**http://localhost:8080/swagger-ui.html**

В Swagger UI вы можете:
1. **Просмотреть все доступные endpoints** - все use cases организованы по тегам:
   - Cash Operations (UC9)
   - Financial Reports (UC10)
   - Cash Reconciliation (UC11)
   - Anomaly Detection (UC12)
   - Game Analysis (UC13)
   - Incidents (UC14)
   - Complaints (UC15)
   - Disciplinary Violations (UC21)
   - Incident Reports (UC14, UC17, UC18, UC19)

2. **Увидеть схемы запросов и ответов** - для каждого endpoint есть полное описание параметров и моделей данных

3. **Выполнить запросы напрямую из браузера** - нажмите "Try it out" на любом endpoint

4. **Изучить модели данных** - все DTO и domain модели задокументированы

### Авторизация в Swagger UI

1. Нажмите кнопку **"Authorize"** (🔒) в правом верхнем углу
2. Введите:
   - Username: `admin`
   - Password: `admin`
3. Нажмите **"Authorize"** и **"Close"**

Теперь вы можете выполнять запросы прямо из Swagger UI! Все запросы будут авторизованы.

### Пример использования Swagger UI для проверки UC9-13

1. Откройте **Cash Operations** → **POST /api/finance/operations**
2. Нажмите **"Try it out"**
3. Отредактируйте body запроса (если нужно)
4. Нажмите **"Execute"**
5. Просмотрите ответ сервера (Response body, Response code)

Аналогично можно проверить все остальные use cases!

## Дополнительные ресурсы

- **Swagger UI:** `http://localhost:8080/swagger-ui.html`
- **OpenAPI JSON:** `http://localhost:8080/v3/api-docs`
- **Health check:** `http://localhost:8080/actuator/health` (если включен Actuator)

